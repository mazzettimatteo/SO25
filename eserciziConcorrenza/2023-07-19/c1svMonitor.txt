Esercizio c.1: Scrivere il monitor sv con una sola funzione entry syncvalue che ha la seguente dichiarazione:
procedure entry int syncvalue(int key);
I processi che chiamano la syncvalue si bloccano sempre. Quando il valore del parametro key è diverso da quello della
precedente chiamata il processo prima di bloccarsi riattiva tutti i processi in attesa. Il valore di ritorno è il numero di
processi con lo stesso valore key sbloccati. Per esempio:
P chiama sv.syncvalue(42), si blocca.
Q chiama sv.syncvalue(42), si blocca.
R chiama sv.syncvalue(44) sblocca P e Q poi si blocca. Il valore di ritorno per P e Q è 2.
T chiama sv.syncvalue(46), sblocca R che ritorna 1 e si blocca.
Q chiama sv.syncvalue(46), si blocca.
P chiama sv.syncvalue(46), si blocca
V chiama sv.syncvalue(0), sblocca T, Q e P (valore di ritorno: 3) poi si blocca...

monitor sv:

condition ok2release //if key!=currKey
int currKey=NULL
int nWaiting=0 

int syncvalue(int key){
    if(key==currKey){       //se la chiave non è cambiata
        nWaiting++          // +1 in attesa
        ok2release.wait()
        ok2release.signal()     //sveglia a cascata gli altri
        result=nWaiting
    }
    else{
        ok2release.signal()     //se cambia la chiave sveglio il primo in attesa che sveglierà tutti gli altri
        currKey=key             //cambio la chiave
        nWaiting=1              //vado in attesa
        ok2release.wait()
        result=nWaiting
    }
    return result
}

/*DUBBIO: se un processo entra nell'else e prima che i processi sbloccati ritornino result, 
result potrebbe essere cambiato dall'primo processo enttrato nell'else*/ => Non ci sono problemi perché la SIGNAL è bloccante




monitor betterSV:

condition ok2release //if key!=currKey
int currKey=NULL
int nWaiting=0 

int syncvalue(int key){
    if(currKey!=key){   //se la chiave è diversa
        currKey=key     //aggiorno la chiave
        nWaiting=0      //resetto il contatore
        ok2release.signal() //sveglio i precedenti processi bloccati
    }
    ok2release.wait()   //in ogni caso vado in attesa
    nWaiting++          //conto tutti i processi appena svegliati
    ok2release.signal() //sveglio a cascata
    return nWaiting
}